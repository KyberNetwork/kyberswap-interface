---
description: Widget packages development guidelines
globs: ["packages/*-widgets/**/*"]
alwaysApply: false
---

# Widget Development Rules

## Package Structure

Every widget package should follow this structure:

```
packages/{widget-name}/
├── src/
│   ├── components/      # React components
│   │   ├── Widget/      # Main widget entry
│   │   └── ...
│   ├── hooks/           # Custom React hooks
│   ├── stores/          # Zustand stores
│   ├── types/           # TypeScript definitions
│   ├── constants/       # Constants and configs
│   ├── utils/           # Utility functions
│   └── index.ts         # Public exports ONLY
├── package.json
├── tsconfig.json
├── vite.config.ts
└── CLAUDE.md            # Package-specific instructions
```

## Export Rules

- Only export from `src/index.ts`
- Keep internal modules private
- Export types separately

```typescript
// src/index.ts
export { Widget } from "./components/Widget";
export type { WidgetProps } from "./types";
```

## Component Pattern

```typescript
// src/components/Widget/index.tsx
import { type FC } from 'react'
import styled from 'styled-components'
import { useWidgetStore } from '../../stores/widget'
import type { WidgetProps } from '../../types'

const Container = styled.div`
  // styles
`

export const Widget: FC<WidgetProps> = ({
  poolAddress,
  chainId,
  theme = 'dark',
  onClose,
  onSuccess,
}) => {
  const { state, actions } = useWidgetStore()

  return (
    <Container>
      {/* content */}
    </Container>
  )
}
```

## Hook Pattern

```typescript
// src/hooks/useZapIn.ts
import { useCallback, useMemo } from "react";
import { useWidgetStore } from "../stores/widget";

export function useZapIn() {
  const { tokenIn, amount } = useWidgetStore();

  const execute = useCallback(async () => {
    // implementation
  }, [tokenIn, amount]);

  return { execute };
}
```

## Store Pattern (Zustand)

```typescript
// src/stores/widget.ts
import { create } from "zustand";

interface WidgetState {
  tokenIn: string | null;
  amount: string;
  setTokenIn: (token: string) => void;
  setAmount: (amount: string) => void;
  reset: () => void;
}

export const useWidgetStore = create<WidgetState>((set) => ({
  tokenIn: null,
  amount: "",
  setTokenIn: (token) => set({ tokenIn: token }),
  setAmount: (amount) => set({ amount }),
  reset: () => set({ tokenIn: null, amount: "" }),
}));
```

## Testing

```bash
# Test single package
pnpm --filter @kyberswap/{package-name} test

# Type check single package
pnpm --filter @kyberswap/{package-name} type-check
```

## Building

```bash
# Build single package
pnpm --filter @kyberswap/{package-name} build

# Build all packages
pnpm build-package
```
